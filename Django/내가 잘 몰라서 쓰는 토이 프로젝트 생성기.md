# 내가 잘 몰라서 쓰는 토이 프로젝트 생성기

뭔가 다 배웠다는데, 뭘 배웠는지 모르겠고, 시작하려니 `mkdir toyproject`하고 멈춰있는 내 모습이 당황스러워 처음부터 복습해보기위해 기록하는 생성기입니다.



**[토이 프로젝트 아이템]**

미정 / Trello 클론한 프론트엔드 프로젝트 결과물을 가지고 백엔드를 구성하는 것과 다른 아이템 중 고민중



**[작업 순서]**

- 배포
  - Django 세팅
  - EC2 세팅
  - DOCKER 세팅
  - Nginx, gunicorn
- 모델링
- 프로젝트 작업 순차 진행

- 문서 작업



## 배포

### Django 세팅

poetry를 이용한 Django setting을 해보려고 합니다.



디렉토리 생성 후 가상환경을 만들 폴더로 이동하겠습니다. 폴더명은 `toyproject`로 하겠습니다.

```
$ mkdir toyproject
$ cd toyproject
```



우선 Django 개발 환경을 설정하겠습니다. 환경명은 `toyproject-env`로 하겠습니다.

```
$ pyenv virtualenv 3.7.5 <환경명>
$ pyenv local <환경명>
```



poetry를 활용하여 Django를 설치하겠습니다. poetry 설치방법은 생략하겠습니다.

```python
$ poetry init # no/no/yes
$ poetry add django
```



Django startproject를 해주겠습니다. project 명은 config라고 설정할 것이고, 외부 폴더명은 config에서 app으로 바꾸는 작업을 하겠습니다.

```
$ django-admin startproject config
$ mv config app
```



이제, pycharm을 실행하겠습니다.

```
$ pycharm-community .
```



pycharm에서 Interpreter 설정을 해주겠습니다. 순서는 아래와 같습니다.

1) Pycharm > File > Settings > Project:toyproject > Project Interpreter

2) Project Interpreter: <No interpreter> 클릭

3) Show All  > '+' 버튼 클릭 > System Interperter

4) interpreter : 옆 '...' 버튼 클릭 후 `/Users/<home name>/.pyenv/versions/<env name>/bin/python` 경로 찾고 OK버튼 > OK 버튼 클릭



현재 목표는 배포과정을 모두 마치는 것이기 때문에 별도의 어플리케이션을 만드는 작업은 뒤로 미루겠습니다. 이제 migrate 작업을 진행합니다. manage.py가 있는 app 폴더로 이동해 진행합니다.

```
$ ./manage.py migrate
```



runserver를 통해 admin에 접속해보겠습니다.

```
$ ./manage.py runserver
```



이제 `http://127.0.0.1:8000/`에 접속하면 Django의 로케트 화면이 우리를 반겨주고 있음을 확인할 수 있습니다.



### EC2 세팅

AWS에서 EC2를 생성합니다. 생성방법과 공개키 생성 및 설정은 django_deployment.md 파일 내 배포 환경 세팅을 참고하세요.



EC2가 생성이 되었다면, 이제 SSH를 사용해 접속해보겠습니다.

```
ssh -i ~/.ssh/[공개키이름].pem ubuntu@[IPv4 퍼블릭 IP]
```



인스턴스 인바운드에 SSH(보안 텔넷) 및 HTTP를 사용하기 위해 인바운드 규칙을 추가해주어야 합니다.

- AWS EC2에 `네트워크 및 보안` 탭에서 `보안 그룹`을 선택하고 인바운드 탭에 `편집` 버튼을 클릭한다.
- `규칙 추가`버튼을 클릭하고 유형: SSH / 소스: 위치무관으로 설정해준 뒤 `저장`한다.
- `규칙 추가`버튼을 클릭하고 유형: HTTP으로 설정해준 뒤 `저장`한다.
- 인바운드 설정에 소스가 ::/0와 0.0.0.0/0 나오면 정상이다.



우선 해당 서버에 필요한 환경을 설치한 후 runserver를 통해 접속이 되는지 확인해봅시다. 해당 서버에 접속한 상태로 아래 코드를 입력해 필요한 환경을 설치합니다.

```
$ sudo apt update
$ sudo apt dist-upgrade

$ sudo apt install python3.7
# keep the local version currently installed 선택
$ sudo apt install python3-pip
$ pip3 list
$ pip3 install django

$ mkdir projects
$ cd projects

$ mkdir toyproject
$ cd toyproject

$ exit
```



다시 해당 서버에 접속해 runserver를 해봅시다.

```
$ ssh -i ~/.ssh/wps12th.pem ubuntu@[IPv4 퍼블릭 IP]
```

```
$ cd ~/projects/django-sample/
$ django-admin startproject config .
$ python3 manage.py runserver 0:80
```



브라우저 주소창에 `IPv4 퍼블릭 IP` 입력 시 `DisallowedHost at /`라고 나오면 정상입니다. settings.py를 열고 아래 설정을 추가해줘야합니다.

```python
$ vim config/settings.py
```

`i` INSERT MODE로 `ALLOWED_HOSTS = ['IPv4 퍼블릭 IP', '*']`으로 수정하고 `ESC` 누른 뒤 `:wq`



```python
$ sudo python3 manage.py runserver 0:80
```

브라우저 주소창에 `IPv4 퍼블릭 IP` 입력 시 장고 로케트 화면 나오면 정상입니다.



지금까지 서버에서 한 작업은 우리가 이전에 Django 프로젝트를 위해 설정한 작업과는 무관했다. 이제 우리가 이전에 Django 프로젝트를 위해 설정한 작업을 옮기고 배포해보자.



---

추후 진행

슈퍼유저 생성 

이제 로그인을 위해 슈퍼 유저 계정을 생성해보겠습니다. 

```
$ ./manage.py createsuperuser
```



애플리케이션 생성