# Functions (CONCAT, CEIL, ROUND, TRUNCATE, DATE_FORMAT, IF, IFNULL, CASE)



## **CEIL(올림), ROUND(반올림), TRUNCATE(버림)**

```mysql
# function 1

select CEIL(12.345);
select ROUND(12.645); # select ROUND(12.645, 2); 소수 2째자리까지 출력
select TRUNCATE(12.345, 2);

use world;
select name, round(gnp/population, 4) as gpp
from country;
```



## DATE_FORMAT

- 날짜 데이터에 대한 포맷을 설정 (https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html)

```mysql
use sakila;
select *
from payment;

select DATE_FORMAT(payment_date, "%Y-%M") as monthly, sum(amount) as total_amount
# 시간은 h/H H는 24시로 표시됨
from payment
group by monthly;
```

참고 https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html



##### function 2 : IF, IFNULL, CASE

- IF

```mysql
# world에서 도시 인구가 100만이 넘으면 "big city", 아니면 "small city"

use world;
select name, population, IF(population >= 10000000 , "big city" , "small city") as city_scale # IF(조건, True, False)
from city;
```



- IFNULL : NULL 데이터를 판단해서 결과 출력

```mysql
# GNPOLD가 NULL인걸 0으로 치환하기

select name, GNPOLD, IFNULL(GNPOLD, 0) #IFNULL(True, False)
from country;
```



- CASE : 여러개의 조건을 사용하는 방법

```mysql
# 조건 : 나라별로 인구가 10억 이상, 1억 이상, 1억 이하를 출력하는 컬럼

SELECT name, population,
	CASE
		WHEN population >= 1000000000 THEN "upper 1 bilion"
		WHEN population >= 100000000 THEN "upper 100 milion"
		ELSE "below 100 milion"
	END AS result
FROM country
```



##### JOIN : 여러개의 테이블 데이터를 모아 보여줄 때 사용

Mysql에서 사용되는 JOIN의 종류 : INNER, OUTER, LEFT, RIGHT

```mysql
use test;

# create table & data
CREATE TABLE user (
user_id int(11) unsigned NOT NULL AUTO_INCREMENT,
name varchar(30) DEFAULT NULL,
PRIMARY KEY (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE addr (
id int(11) unsigned NOT NULL AUTO_INCREMENT,
addr varchar(30) DEFAULT NULL,
user_id int(11) DEFAULT NULL,
PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

INSERT INTO user(name)
VALUES ("jin"),
("po"),
("alice"),
("petter");

INSERT INTO addr(addr, user_id)
VALUES ("seoul", 1),
("pusan", 2),6
("deajeon", 3),
("deagu", 5),
("seoul", 6);
```



- INNER :공통된 정보 출력

- LEFT JOIN: 왼쪽만 출력
- RIGHT JOIN: 오른쪽만 출력
- OUTER JOIN: 모두 출력



```mysql
# INNER JOIN : 테이블간에 공통된 값이 없는 data는 출력하지 않는다.
SELECT *
FROM user
JOIN addr # INNER JOIN은 생략이 가능하다?
# user와 addr 테이블이 JOIN이 된다.

ON user.user_id = addr.user_id
# 특정 키 값이 같은 애들만 필터링

SELECT user.user_id, user.name, addr.addr
FROM user, addr
where user.user_id = addr.user_id
# 같은 결과가 출력됨


# LEFT JOIN
SELECT user.user_id, user.name, addr.addr
FROM user
LEFT JOIN addr
ON user.user_id = addr.user_id

# RIGHT JOIN
SELECT addr.user_id, user.name, addr.addr
FROM user # 왼쪽에 있는 애
RIGHT JOIN addr # 오른쪽에 있는 애
ON user.user_id = addr.user_id
```



```mysql
# world : 도시인구가 800만이 넘는 도시이름, 국가이름, 도시인구, 국가인구를 출력
USE world;

SELECT city.name, country.name, city.population, country.population, city.population/country.population as avg
FROM city
JOIN country
on city.countrycode = country.code
WHERE city.population >= 8000000

select *
from country 
```



```mysql
# OUTER JOIN : UNION을 이용해서 할 수 있음/ UNION는 데이터를 합치고 중복 데이터를 제거하는 특징이 있다.
# 중복 데이터를 지우지 않으려면 UNION ALL을 사용한다.
use test;

SELECT name
FROM user
UNION
SELECT addr
FROM addr;

# OUTER JOIN
SELECT user.user_id, user.name, addr.addr
FROM user
LEFT JOIN addr
WHERE user.user_id = addr.user_id
UNION
SELECT addr.user_id, user.name, addr.addr
FROM user
RIGHT JOIN addr
WHERE user.user_id = addr.user_id
```



##### Sub Query : 쿼리안에 쿼리

SELECT, FROM, WHERE 절에서 사용가능

```mysql
# 전체 도시수, 전체 나라수, 전체 언어수
use world;
select count(name) from city
select count(name) from country
select count(distinct(language)) from countrylanguage # distinct 중복제거
```

```mysql
SELECT
(select count(name) from city) as city,
(select count(name) from country) as country,
(select count(distinct(language)) from countrylanguage) as countrylanguage
FROM DUAL
```

```mysql
# 도시 인구가 800만 이상인 도시의 도시이름, 도시인구, 국가이름 출력
USE world;

select *
from(
    SELECT countrycode, name, population
    FROM city
    WHERE population >= 8000000
) as sub1
JOIN (
    select code, name
    from country
) as sub2
on sub1.countrycode = sub2.code
```

```mysql
# WHERE 절 SUB QUERY
# 800만 이상 도시의 국가코드, 국가이름, GNP 출력
SELECT code, name, GNP
FROM country
WHERE code IN (
    select countrycode
    from city
    WHERE population > 8000000
)
```

