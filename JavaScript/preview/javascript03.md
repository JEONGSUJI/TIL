# 자바스크립트 실행환경

## 1. 브라우저와 Node.js의 실행환경

- 공통점

  - 자바스크립트를 해석하고 실행할 수 있는 자바스크립트 엔진을 내장하고 있다.
  - 자바스크립트 코어인 ECMA Script 실행 가능하다.

- 차이점

|             | 브라우저                                                                                | Node.js            |
| ----------- | --------------------------------------------------------------------------------------- | ------------------ |
| 목적        | HTML, CSS, JS를 실행해 웹페이지를 브라우저 화면에 렌더링                                | 서버 개발환경 제공 |
| DOM API     | 제공                                                                                    | 미제공             |
| File 시스템 | 미제공 (Web API인 FileReader 객체를 사용해 사용자가 지정한 파일을 읽어들이는 것은 가능) | 제공               |

---

## 2. 웹 브라우저

### 웹 브라우저는 어떻게 동작하는가?

1. 사용자가 참조하고자하는 웹페이지를 서버에 요청하고 서버의 응답을 받아 브라우저에 표시한다.
2. 브라우저는 서버로부터 HTML,CSS, 자바스크립트, 이미지 파일 등을 응답받는다.
3. HTML, CSS 파일은 렌더링 엔진의 HTML 파서와 CSS 파서에 의해 파싱되어 DOM, CSSOM 트리로 변환되고, 렌더트리로 결합된다. 이렇게 생성된 렌더트리를 기반으로 브라우저는 웹페이지를 표시한다.
4. 자바스크립트는 자바스크립트 엔진이 처리한다.

> 파싱이란?  
> 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 말한다. 일련의 문자열을 의미있는 토큰으로 분해하고 이들로 이루어진 파스 트리를 만드는 과정이다.

> 파서란?  
> 인터프리터나 컴파일러의 구성요소 가운데 하나로 입력 토큰에 내재된 자료구조를 빌드하고 문법 검사를 실행하는 것을 말한다.

![](https://poiemaweb.com/assets/fs-images/3-2.png)
이미지 출처: https://poiemaweb.com/fastcampus/environment

### 컴파일러와 인터프리터

_자바스크립트는 인터프리터 언어로 구분한다_

| 컴파일러                                     | 인터프리터                                                                 |
| -------------------------------------------- | -------------------------------------------------------------------------- |
| 소스코드 전체 한번에 머신코드로 변환 후 실행 | 런타임에 문 단위로 한 줄씩 중간 코드인 바이트 코드로 변환 후 실행          |
| 실행파일 생성                                | 실행파일 미생성                                                            |
| 컴파일과 실행단계의 분리                     | 인터프리트 단계와 실행단계 미분리. 한 줄씩 바이트 코드로 변환 후 즉시 실행 |
| 실행에 앞서 컴파일 단 한번 수행              | 코드 실행될 때마다 인터프리트 과정 반복 수행                               |
| 코드 실행 속도 빠름                          | 코드 실행 속도 비교적 느림                                                 |

### 자바스크립트 엔진의 소스 코드 실행 과정

1. 문자열인 소스코드를 해석하여 문법적인 의미와 구조를 갖는 자료구조인 AST(Abstract Syntax Tree, 추상적 구문 트리)를 생성한다.
2. AST를 바이트 코드를 생성하여 실행한다.

![](https://poiemaweb.com/assets/fs-images/3-3.png)
이미지 출처: https://poiemaweb.com/fastcampus/environment

### HTML 내 자바스크립트 선언 위치의 중요성

- HTML 내 자바스크립트 동작 과정  
  HTML 파서는 script 태그를 만나면 JS 코드를 실행하기 위해 DOM 생성 프로세스를 중지하고 자바스크립트 엔진으로 제어권한을 넘긴다. 제어권한을 넘겨받은 자바스크립트 엔진은 script 태그 내의 자바스크립트 코드 또는 script 태그의 src 어트리뷰트에 정의딘 자바스크립트 파일을 로드하고 파싱하여 실행한다. 실행이 완료되면 다시 HTML 파서로 제어 권한을 넘겨 브라우저가 중지했던 시점부터 DOM 생성을 제개한다.

- HTML 내 자바스크립트 위에 선언 시 발생할 수 있는 문제점  
  1 ) 스크립트 로딩 지연으로 인해 렌더링에 지장을 받을 수 있다.  
  2 ) Dom 요소를 참조하는 경우 Dom 객체 변환 이전에 선언 시 동작이 바르게 동작되지 않을 수 있다.

- HTML5 추가된 script 태그인 async, defer를 사용하면 되지 않을까?  
  스크립트의 로딩 지연으로 인한 병목 현상을 근본적으로 방지하기 위해 추가된 async와 defer 어트리뷰트를 사용하여 해결할 수 있을 것 같지만, 결국 IE9 이하 버전에서는 정상적으로 잘 동작하지 않을 수 있는 위험성이 있다. 잘 동작하지 않는 경우 동기적으로 스크립트가 실행된다.

- _따라서, body 가장 아래에 자바스크립트를 위치시키는 것이 좋다._

---

# 3. Node.js

## Node.js소개

- 2009년 라이언 달(Ryan Dahl)이 발표했다.
- 크롬 V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임 환경이다.
- 브라우저에서만 동작하던 자바스크립트를 브라우저 이외의 환경에서 동작시킬 수 있는 자바스크립트 실행환경을 말한다.
- 서버 사이드 애플리케이션 개발에 사용되며 이에 필요한 모듈, 파일 시스템, HTTP 등 빌트인 API를 제공한다.
- 데이터를 실시간 처리하여 빈번한 I/0가 발생하는 SPA에 적합하지만, CPU 사용률이 높은 애플리케이션에는 권장하지 않는다.

## npm

- node package manager / 자바스크립트 패키지매니저
- Node.js에서 사용할 수 있는 모듈들을 패키지화하여 모아둔 저장소 역할
- 패키지 설치 및 관리를 위한 CLI를 제공한다.
- 자신이 작성한 패키지를 공개할 수도 있고 필요한 패키지를 검색하여 재사용할 수도 있다.

## Node.js REPL

- REPL(Read Eval Print Loop)는 Node.js는 물론 대부분의 언어가 제공하는 가상환경으로 간단한 코드를 직접 실행해 결과를 확인해 볼 수 있다.

이미지 출처: https://poiemaweb.com/fastcampus/environment
